---
title: "AI-naloga-unfinished"
output:
  pdf_document: default
  html_notebook: default
---

## Obdelava podatkov in dodajanje atributov

Na začetku uvozimo podatke z gumbom v RStudio imenovanem "Import Dataset" in sicer izberemo opcijo "From Text(base)". Nato ustvarimo novo delovno spremenljivko "data", da ostane prvotna spremenljivka nespremenjena. 


```{r Uvoz podatkov}
dataSem1 <- read.csv("../dataSem1.txt", stringsAsFactors=TRUE)

data <- dataSem1
data$regija <- as.factor(data$regija)
data$namembnost <- as.factor(data$namembnost)
data$norm_poraba <- as.factor(data$norm_poraba)
data$stavba <- as.factor(data$stavba)

head(data)
```
Atribute "regija", "namembnost" in "norm_poraba" faktoriziramo, da programski jezik razbere zalogo vrednosti. V tabeli zgoraj je prikazanih prvih nekaj vrstic. 

```{r Določitev tipa atributa "datum"}
library(tictoc)
data$datum <- as.Date(data$datum)
head(data)

```
Lastnost atributa "datum" nastavimo na <date>.

```{r Dodan atribut mesec}
library(lubridate)

newData <- week(data$datum)

data$teden <- newData

newNewData <- month(data$datum)
data$mesec <- newNewData

head(data)
```
V tem delu dodamo nova atributa "teden" in "mesec" za lažje nadaljno delo. Za pomoč uporabimo knjižnico "lubridate".

```{r Dodan atribut vikend}
library(chron)

x <- is.weekend(data$datum)
data$vikend <- x
```
Zgornja koda prikazuje kako dodamo atribut "vikend", ki ima vrednost TRUE, če je dan sobota ali nedelja, oziroma FALSE, če je delovni dan. Pomagamo si s knjižnico "chron".


```{r Dodan atribut UNIX}
data$UNIX <- as.numeric(as.POSIXct(paste(data$datum, data$ura, sep=" ")))
```
Ustvarimo splošen atribut za čas, ki nam omogoča lažje sortiranje.




```{r Ustvarjen kronološko sortiran seznam}
a <- order(data$stavba, data$ura, data$UNIX)
sortedDF <- data[a,]
sortedDF
```
Dataframe sortiramo po številki stavbe, uri meritve in UNIX času.


```{r Izračun podatkov meritve prejšnjega dne}
tic()
vect = vector()
starTemp = 0
uraMeritve = 0
for (row in 1:nrow(sortedDF))
{
  if(uraMeritve == sortedDF[row, "ura"]) {
    vect <- c(vect, starTemp)
  }
  else {
    uraMeritve = sortedDF[row, "ura"]
    vect <- c(vect, sortedDF[row, "temp_zraka"])
  }
  starTemp = sortedDF[row, "temp_zraka"]
}
toc()
```

```{r Dodan atribut temperatura prejšnjega dne}
sortedDF$norm_poraba <- factor(sortedDF$norm_poraba, levels=c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA"))
sortedDF$ura <- factor(sortedDF$ura)
sortedDF$oblacnost <- factor(sortedDF$oblacnost)

sortedDF$prev_temp <- vect
head(sortedDF)
```
S kodo zgornjih dveh odlomkov vsaki meritvi v sortirani matriki poiščemo meritev temperature prejšnjega dne in ji le to dopišemo v poseben stolpec z atributi.



```{r Izračun temperature prejšnjih 7 dni}
tic()
vect = vector()
starTemp = 0
uraMeritve = 0
substract = 0
beginning = 0
stevec = 0
for (row in 1:nrow(sortedDF))
{
  if(beginning < row-7)
    stevec = row-7
  else
    stevec = beginning
  if(uraMeritve == sortedDF[row, "ura"]) {
    starTemp = 0
    
    for (i in stevec:(row-1))
      starTemp = starTemp + sortedDF[i, "temp_zraka"]
    avgTemp = starTemp / (row - stevec)
    vect <- c(vect, avgTemp)
  }
  else {
    beginning = row
    uraMeritve = sortedDF[row, "ura"]
    vect <- c(vect, sortedDF[row, "temp_zraka"])
  }
  starTemp = sortedDF[row, "temp_zraka"]
}
toc()
```

```{r Dodan atribut temperatura prejšnjih 7 dni}
sortedDF$temp_teden <- vect
head(sortedDF)
```
Z zanko se sprehodimo po vsaki meritvi v matriki in izračunamo povprečje največ zadnjih 7 meritev za isto stavbo ob isti uri. Povprečno temperaturo zapišemo v stolpec z imenom "temp_teden".

## Analiza podatkov

```{r Grafi analize}
library("plot3D")
library(dplyr)
usefull_data <- filter(sortedDF, smer_vetra > 0)
scatter2D(usefull_data$smer_vetra, usefull_data$temp_zraka, clab = c("Temperatura zraka", "smer_vetra, hitrost_vetra"))
scatter3D(usefull_data$smer_vetra, usefull_data$hitrost_vetra, usefull_data$temp_zraka, phi = 10, theta = 20, bty ="g", ticktype = "detailed")
```



## Večinski razred

```{r Graf razporeditve po normirani porabi}
plot(sortedDF$norm_poraba, main = "Porazdelitev primerov glede na normirano stopnjo porabe")
```

```{r Številski opis normirane porabe}
summary(sortedDF$norm_poraba)
```
Večinski parameter je vrednost "SREDNJA", ki predstavlja 76.435 vrednosti od 206.785, kar je 0,3696 od celotne zaloge elementov.

### Analiza večinskega modela

```{r Matrika dejanskih vrednosti nominirane temperature}
library(nnet)

observedMat <- list()
for (i in 1:11) {
  observedMat[[i]] <- class.ind(factor(filter(sortedDF, mesec == i+1)$norm_poraba, levels=c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")))
}
head(observedMat[[1]])
```
Za izluščenje le posameznega meseca se uporabi knjižnica "dplyr", kjer s pomočjo fukcije "filter" izluščimo le podatke določenega meseca.

```{r Barierjev test večinskih modelov}

cat("Večinski model\n")
for(i in 1:11){
  p0 <- table(filter(sortedDF, mesec <= i+1)$norm_poraba)/nrow(filter(sortedDF, mesec <= i+1))
  cat("Mesec =", i+1, " ->  ")
  p0Mat <- matrix(rep(p0, times=nrow(observedMat[[i]])), nrow = nrow(observedMat[[i]]), byrow = T)
  colnames(p0Mat) <- names(p0)
  bar <- sum((observedMat[[i]] - p0Mat) ^ 2) / nrow(p0Mat)
  cat(bar, "\n")
}

```


```{r Funkcija informacijske vsebine odgovora}
inf.score <- function(trainClass, testClass, predMat) {
  result <- 0
  priors <- table(trainClass) / length(trainClass)
  
  for (i in 1:nrow(predMat)) {
    p.prior <- priors[testClass[i]]
    p.posterior <- predMat[i, testClass[i]]
    
    if(p.posterior >= p.prior) {
      result <- result - log2(p.prior) + log2(p.posterior)
    }
    else
      result <- result + log2(1-p.prior) - log2(1-p.posterior)
  }
  
  result/nrow(predMat)
}
```


```{r Izračun informacijske vsebine trivialnega modela}
cat("Informacijska vsebina trivialnega modela\n")
for (i in 1:11) {
  p0 <- table(filter(sortedDF, mesec <= i+1)$norm_poraba)/nrow(filter(sortedDF, mesec <= i+1))
  cat("Mesec =", i+1, " ->  ")
  p0Mat <- matrix(rep(p0, times=nrow(filter(sortedDF, mesec == i+1))), nrow = nrow(filter(sortedDF, mesec == i+1)), byrow = T)
  cat(inf.score(filter(sortedDF, mesec <= i)$norm_poraba, filter(sortedDF, mesec == i+1)$norm_poraba, p0Mat), "\n")
}
```


## Odločitveno drevo

```{r Izračun odločitvenih dreves}
library(rpart)

dt_list <- list()
tic()
for(m in 1:11) {
  tempDF <- filter(sortedDF, mesec <= m)
  
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  dt_list[[m]] <- rpart(norm_poraba ~ ., data = tempDF, cp = 0)
  tab <- printcp(dt_list[[m]])
  row <- which.min(tab[,"xerror"])
  th <- mean(c(tab[row, "CP"], tab[row-1, "CP"]))
  dt_list[[m]] <- prune(dt_list[[m]], cp = th)
}

cat("\014")
toc()
rm(tab)
rm(row)
rm(th)
```
Zgoraj so narejena drevesa za vseh 11 mesecev razen decembra, ki se samo testira.



```{r Izris odločitvenih dreves}
library(rpart.plot)

#for(m in dt_list)
  #rpart.plot(m)
```



```{r Napoved odločitvenih dreves}
tic("Total")

predicted <- list()
for (i in 1:11) {
  tic(i)
  tempDF <- filter(sortedDF, mesec == i+1)
  predicted[[i]] <- predict(dt_list[[i]], tempDF, type = "class")
  toc()
}
toc()
```

### Analiza odločitvenega drevesa
```{r Pravilnost rezultatov odločitvenih dreves}
# Tabela zmot
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF, mesec == i+1)$norm_poraba == predicted[[i]]
  cat(mean(q))
  #tab <- table(predicted[[i]],filter(sortedDF, mesec == i+1)$norm_poraba)
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```


```{r Senzitivnost odločitvenih dreves}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predicted[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab["SREDNJA",]), "\n")
}
```



```{r Specifičnost odločitvenih dreves}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predicted[[i]])
  cat((sum(tab)-sum(tab["SREDNJA",])-sum(tab[,"SREDNJA"])+tab["SREDNJA","SREDNJA"])/(sum(tab)-sum(tab[,"SREDNJA"])), "\n")
}
```


```{r Preciznost odločitvenih dreves}
#cat("Preciznost za 'SREDNJA'\n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predicted[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab[,"SREDNJA"]), "\n")
}
```

```{r Izračun matrike napovedi odločitvenih dreves}
i = 1
predictedMat <- list()
for (dt in dt_list) {
  tempDF <- filter(sortedDF, mesec == i+1)
  predictedMat[[i]] <- predict(dt, tempDF, type = "prob")
  i = i + 1
}
col.order <- c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")
head(predictedMat[[1]][,col.order])
```



```{r Barierjev test odločitvenih dreves}
print("Barier's test", quote = F)
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  bar <- sum((observedMat[[i]] - predictedMat[[i]]) ^ 2) / nrow(predictedMat[[i]])
  cat(bar, "\n")
}
```



```{r Izračun informacijske vsebine odločitvenih dreves}
cat("Informacijska vsebina odgovora\n")
for (i in 1:11) {
  cat("Mesec =", i+1, " ->  ")
  cat(inf.score(filter(sortedDF, mesec <= i)$norm_poraba, filter(sortedDF, mesec == i+1)$norm_poraba, predictedMat[[i]]), "\n")
}
```


## Naivni Bayesov klasifikator

```{r Parallel libraries}
library(iterators)
library(parallel)
library(foreach)
library(doParallel)
numCores <- detectCores()
numCores
registerDoParallel(cores = numCores)
```


```{r Izračun modelov Naivni Bayes}
library(e1071)

nb_list <- list()
tic()
for(m in 1:11) {
  tempDF <- filter(sortedDF, mesec <= m)
  
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  nb_list[[m]] <- naiveBayes(norm_poraba ~ ., data = tempDF)
}
toc()
```


```{r Napoved po naivnem Bayesu paralelizirana}
tempDF <- list()
tic()
predictedBayes <- list()
predictedBayes <- foreach (i=1:11) %dopar% {
  tempDF[[i]] <- filter(sortedDF, mesec == i+1)
  predictedBayes[[i]] <- predict(nb_list[[i]], tempDF[[i]], type = "class")
}
cat("\014")
toc()
```


### Analiza Naivnega Bayesovega klasifikatorja

```{r Pravilnost rezultatov Naivnega Bayesa}
# Tabela zmot
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF, mesec == i+1)$norm_poraba == predictedBayes[[i]]
  cat(mean(q))
  #tab <- table(predicted[[i]],filter(sortedDF, mesec == i+1)$norm_poraba)
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```

```{r Senzitivnost Naivnega Bayesa}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedBayes[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab["SREDNJA",]), "\n")
}
```



```{r Specifičnost Naivnega Bayesa}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedBayes[[i]])
  cat((sum(tab)-sum(tab["SREDNJA",])-sum(tab[,"SREDNJA"])+tab["SREDNJA","SREDNJA"])/(sum(tab)-sum(tab[,"SREDNJA"])), "\n")
}
```


```{r Preciznost Naivnega Bayesa}
#cat("Preciznost za 'SREDNJA'\n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedBayes[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab[,"SREDNJA"]), "\n")
}
```

```{r Izračun matrike napovedi Naivnega Bayesa}
tic()
tempDF <- list()
predictedMat <- list()
predictedMat <- foreach (i=1:11) %dopar% {
  tempDF[[i]] <- filter(sortedDF, mesec == i+1)
  predictedMat[[i]] <- predict(nb_list[[i]], tempDF[[i]], type = "raw")
}
col.order <- c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")
toc()
head(predictedMat[[1]][,col.order])
```


```{r Barierjev test Naivnega Bayesa}
print("Barier's test", quote = F)
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  bar <- sum((observedMat[[i]] - predictedMat[[i]]) ^ 2) / nrow(predictedMat[[i]])
  cat(bar, "\n")
}
```



```{r Izračun informacijske vsebine Naivnega Bayesa}
cat("Informacijska vsebina odgovora\n")
for (i in 1:11) {
  cat("Mesec =", i+1, " ->  ")
  cat(inf.score(filter(sortedDF, mesec <= i)$norm_poraba, filter(sortedDF, mesec == i+1)$norm_poraba, predictedMat[[i]]), "\n")
}
```



## K-najbližjih sosedov

```{r Izbira parametra kInNN za K-najbližjih sosedov}
library(CORElearn)
tic("Creating 20 models")
knn_list_kInNN <- list()
tempDF <- filter(sortedDF, mesec <= 1)
drops <- c("poraba")
tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
for(m in 1:20) {
  knn_list_kInNN[[m]] <- CoreModel(norm_poraba ~ ., data = tempDF, model = "knn", kInNN = m)
}
cat("\014")
toc()

tempDF <- filter(sortedDF, mesec == 2)
predictedMatKInKNN <- list()
tic("Predicting on 20 models")
bar <- foreach (i=1:20, .combine=c) %dopar% {
  predictedMatKInKNN[[i]] <- predict(knn_list_kInNN[[i]], tempDF, type = "prob")
  bar <- sum((observedMat[[1]] - predictedMatKInKNN[[i]]) ^ 2) / nrow(predictedMatKInKNN[[i]])
}
toc()
print(bar)
```



```{r Izračun modela K-najbližjih sosedov}
knn_list <- list()
tic("Total")
for(m in 1:11) {
  tempDF <- filter(sortedDF, mesec <= m)
  
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  knn_list[[m]] <- CoreModel(norm_poraba ~ ., data = tempDF, model = "knn", kInNN = 5)
}
cat("\014")
toc()
```


```{r Napoved po modelu K-najbližjih sosedov}
tic("Total")
predictedKNN <- list()
predictedKNN <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF, mesec == i+1)
  predictedKNN[[i]] <- predict(knn_list[[i]], tempDF, type = "class")
}
toc()
```


### Analiza modela K-najbližjih sosedov

```{r Pravilnost rezultatov modela K-najbližjih sosedov}
# Tabela zmot
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF, mesec == i+1)$norm_poraba == predictedKNN[[i]]
  cat(mean(q))
  #tab <- table(predicted[[i]],filter(sortedDF, mesec == i+1)$norm_poraba)
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```

```{r Senzitivnost modela K-najbližjih sosedov}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedKNN[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab["SREDNJA",]), "\n")
}
```



```{r Specifičnost modela K-najbližjih sosedov}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedKNN[[i]])
  cat((sum(tab)-sum(tab["SREDNJA",])-sum(tab[,"SREDNJA"])+tab["SREDNJA","SREDNJA"])/(sum(tab)-sum(tab[,"SREDNJA"])), "\n")
}
```


```{r Preciznost modela K-najbližjih sosedov}
#cat("Preciznost za 'SREDNJA'\n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedKNN[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab[,"SREDNJA"]), "\n")
}
```



```{r Izračun matrike napovedi modela K-najbližjih sosedov}
tic("Total")
predictedMatKNN <- list()
predictedMatKNN <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF, mesec == i+1)
  predictedMatKNN[[i]] <- predict(knn_list[[i]], tempDF, type = "prob")
}
col.order <- c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")
toc()
head(predictedMatKNN[[1]][,col.order])
```



```{r Barierjev test modela K-najbližjih sosedov}
print("Barier's test", quote = F)
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  bar <- sum((observedMat[[i]] - predictedMatKNN[[i]]) ^ 2) / nrow(predictedMatKNN[[i]])
  cat(bar, "\n")
}
```



```{r Izračun informacijske vsebine modela K-najbližjih sosedov}
cat("Informacijska vsebina odgovora\n")
for (i in 1:11) {
  cat("Mesec =", i+1, " ->  ")
  cat(inf.score(filter(sortedDF, mesec <= i)$norm_poraba, filter(sortedDF, mesec == i+1)$norm_poraba, predictedMatKNN[[i]]), "\n")
}
```


## Naključni gozd

```{r Izračun Naključnih gozdov}
library(randomForest)
tic("Total")
rm(tempDF)
rf_list <- list()
rf_list <- foreach (m=1:11) %dopar% {
  tempDF <- filter(sortedDF, mesec <= m)
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  rf_list[[m]] <- randomForest(norm_poraba ~ ., data = tempDF)
}
toc()
```


```{r Dopolnilo Naključnih gozdov}
library(randomForest)
tic("Total")

rf_list2 <- list()
rf_list2 <- foreach (m=1) %do% {
  tempDF <- filter(sortedDF, mesec <= m)
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  rf_list2[m] <- randomForest(norm_poraba ~ ., data = tempDF)
}
toc()

rf_list2
```


```{r Napoved po Naključnem gozdu}
tic("Total")
predictedRF <- list()
predictedRF <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF, mesec == i+1)
  predictedRF[[i]] <- predict(rf_list[[i]], tempDF, type = "class")
}
toc()
```


### Analiza Naključnega gozda

```{r Pravilnost rezultatov Naključnega gozda}
# Tabela zmot
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF, mesec == i+1)$norm_poraba == predictedRF[[i]]
  cat(mean(q))
  #tab <- table(predicted[[i]],filter(sortedDF, mesec == i+1)$norm_poraba)
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```

```{r Senzitivnost Naključnega gozda}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedRF[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab["SREDNJA",]), "\n")
}
```



```{r Specifičnost Naključnega gozda}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedRF[[i]])
  cat((sum(tab)-sum(tab["SREDNJA",])-sum(tab[,"SREDNJA"])+tab["SREDNJA","SREDNJA"])/(sum(tab)-sum(tab[,"SREDNJA"])), "\n")
}
```


```{r Preciznost Naključnega gozda}
#cat("Preciznost za 'SREDNJA'\n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF, mesec == i+1)$norm_poraba, predictedRF[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab[,"SREDNJA"]), "\n")
}
```



```{r Izračun matrike napovedi Naključnega gozda}
tic("Total")
predictedMatRF <- list()
predictedMatRF <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF, mesec == i+1)
  predictedMatRF[[i]] <- predict(rf_list[[i]], tempDF, type = "prob")
}
col.order <- c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")
toc()
head(predictedMatRF[[1]][,col.order])
```



```{r Barierjev test Naključnega gozda}
print("Barier's test", quote = F)
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  bar <- sum((observedMat[[i]] - predictedMatRF[[i]]) ^ 2) / nrow(predictedMatRF[[i]])
  cat(bar, "\n")
}
```



```{r Izračun informacijske vsebine Naključnega gozda}
cat("Informacijska vsebina odgovora\n")
for (i in 1:11) {
  cat("Mesec =", i+1, " ->  ")
  cat(inf.score(filter(sortedDF, mesec <= i)$norm_poraba, filter(sortedDF, mesec == i+1)$norm_poraba, predictedMatRF[[i]]), "\n")
}
```


## Ocena kvalitete artibutov

```{r Izračun bitov posameznega atributa}
tempDF <- sortedDF
drops <- c("poraba")
tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
tempDF$stavba <- as.factor(tempDF$stavba)
sort(attrEval(norm_poraba ~ ., data = tempDF, "InfGain"), decreasing = T)
``` 

```{r Potrebna vrednost atributov za klasifikacijo}
o0 <- table(tempDF$norm_poraba)/length(tempDF$norm_poraba)
-sum(o0*log2(o0))
```



```{r Izračun MDL}
tic()
sort(attrEval(norm_poraba ~ ., data = tempDF, "MDL"), decreasing = T)
toc()
``` 

```{r Izris}
plot(tempDF, col=tempDF$norm_poraba)
``` 


```{r}
drops <- c("datum", "UNIX", "hitrost_vetra", "padavine", "smer_vetra", "oblacnost", "pritisk")
sortedDF_reduced <- tempDF[ , !(names(tempDF) %in% drops)]
```

```{r}
names(sortedDF_reduced)

max_vals <- apply(sortedDF_reduced[,c(5,6,7,8,10,13,14)], 2, max)
min_vals <- apply(sortedDF_reduced[,c(5,6,7,8,10,13,14)], 2, min)

sortedDF_scaled <- scale(sortedDF_reduced[,c(5,6,7,8,10,13,14)], center = min_vals, scale = max_vals - min_vals)
sortedDF_scaled <- data.frame(sortedDF_scaled)
sortedDF_scaled$ura <- sortedDF_reduced$ura
sortedDF_scaled$regija <- sortedDF_reduced$regija
sortedDF_scaled$stavba <- sortedDF_reduced$stavba
sortedDF_scaled$namembnost <- sortedDF_reduced$namembnost
sortedDF_scaled$norm_poraba <- sortedDF_reduced$norm_poraba
sortedDF_scaled$vikend <- sortedDF_reduced$vikend
sortedDF_scaled$mesec <- sortedDF_reduced$mesec

summary(sortedDF_scaled)
```


## Odločitvena drevesa na izbranih atributih

```{r Izračun odločitvenih dreves na izbranih atributih}
library(rpart)

dt_list <- list()
tic()
for(m in 1:11) {
  tempDF <- filter(sortedDF_reduced, mesec <= m)
  
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  dt_list[[m]] <- rpart(norm_poraba ~ ., data = tempDF, cp = 0)
  tab <- printcp(dt_list[[m]])
  row <- which.min(tab[,"xerror"])
  th <- mean(c(tab[row, "CP"], tab[row-1, "CP"]))
  dt_list[[m]] <- prune(dt_list[[m]], cp = th)
}

cat("\014")
toc()
rm(tab)
rm(row)
rm(th)
```

```{r Napoved odločitvenih dreves na izbranih atributih}
tic("Total")

predicted <- list()
for (i in 1:11) {
  tic(i)
  tempDF <- filter(sortedDF_reduced, mesec == i+1)
  predicted[[i]] <- predict(dt_list[[i]], tempDF, type = "class")
  toc()
}
toc()
```

### Analiza odločitvenega drevesa
```{r Pravilnost rezultatov odločitvenih dreves na izbranih atributih}
# Tabela zmot
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF_reduced, mesec == i+1)$norm_poraba == predicted[[i]]
  cat(mean(q))
  #tab <- table(predicted[[i]],filter(sortedDF, mesec == i+1)$norm_poraba)
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```


```{r Senzitivnost odločitvenih dreves na izbranih atributih}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predicted[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab["SREDNJA",]), "\n")
}
```


```{r Specifičnost odločitvenih dreves na izbranih atributih}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predicted[[i]])
  cat((sum(tab)-sum(tab["SREDNJA",])-sum(tab[,"SREDNJA"])+tab["SREDNJA","SREDNJA"])/(sum(tab)-sum(tab[,"SREDNJA"])), "\n")
}
```


```{r Preciznost odločitvenih dreves na izbranih atributih}
#cat("Preciznost za 'SREDNJA'\n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predicted[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab[,"SREDNJA"]), "\n")
}
```


```{r Izračun matrike napovedi odločitvenih dreves na izbranih atributih}
i = 1
predictedMat <- list()
for (dt in dt_list) {
  tempDF <- filter(sortedDF_reduced, mesec == i+1)
  predictedMat[[i]] <- predict(dt, tempDF, type = "prob")
  i = i + 1
}
col.order <- c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")
head(predictedMat[[1]][,col.order])
```


```{r Barierjev test odločitvenih dreves na izbranih atributih}
print("Barier's test", quote = F)
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  bar <- sum((observedMat[[i]] - predictedMat[[i]]) ^ 2) / nrow(predictedMat[[i]])
  cat(bar, "\n")
}
```


```{r Izračun informacijske vsebine odločitvenih dreves na izbranih atributih}
cat("Informacijska vsebina odgovora\n")
for (i in 1:11) {
  cat("Mesec =", i+1, " ->  ")
  cat(inf.score(filter(sortedDF_reduced, mesec <= i)$norm_poraba, filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predictedMat[[i]]), "\n")
}
```



## Naključni gozd na izbranih atributih

```{r Izračun Naključnih gozdov na izbranih atributih}
library(randomForest)
tic("Total")
rm(tempDF)
rf_list <- list()
rf_list <- foreach (m=1:11) %dopar% {
  tempDF <- filter(sortedDF_reduced, mesec <= m)
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  rf_list[[m]] <- randomForest(norm_poraba ~ ., data = tempDF)
}
toc()
```


```{r Dopolnilo Naključnih gozdov na izbranih atributih}
library(randomForest)
tic("Total")

rf_list2 <- list()
rf_list2 <- foreach (m=1) %do% {
  tempDF <- filter(sortedDF_reduced, mesec <= m)
  drops <- c("poraba")
  tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
  rf_list2[m] <- randomForest(norm_poraba ~ ., data = tempDF)
}
toc()

rf_list2
```


```{r Napoved po Naključnem gozdu na izbranih atributih}
tic("Total")
predictedRF <- list()
predictedRF <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF_reduced, mesec == i+1)
  predictedRF[[i]] <- predict(rf_list[[i]], tempDF, type = "class")
}
toc()
```


### Analiza Naključnega gozda

```{r Pravilnost rezultatov Naključnega gozda na izbranih atributih}
# Tabela zmot
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF_reduced, mesec == i+1)$norm_poraba == predictedRF[[i]]
  cat(mean(q))
  #tab <- table(predicted[[i]],filter(sortedDF_reduced, mesec == i+1)$norm_poraba)
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```

```{r Senzitivnost Naključnega gozda na izbranih atributih}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predictedRF[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab["SREDNJA",]), "\n")
}
```



```{r Specifičnost Naključnega gozda na izbranih atributih}
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predictedRF[[i]])
  cat((sum(tab)-sum(tab["SREDNJA",])-sum(tab[,"SREDNJA"])+tab["SREDNJA","SREDNJA"])/(sum(tab)-sum(tab[,"SREDNJA"])), "\n")
}
```


```{r Preciznost Naključnega gozda na izbranih atributih}
#cat("Preciznost za 'SREDNJA'\n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  tab <- table(filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predictedRF[[i]])
  cat(tab["SREDNJA", "SREDNJA"]/sum(tab[,"SREDNJA"]), "\n")
}
```



```{r Izračun matrike napovedi Naključnega gozda na izbranih atributih}
tic("Total")
predictedMatRF <- list()
predictedMatRF <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF, mesec == i+1)
  predictedMatRF[[i]] <- predict(rf_list[[i]], tempDF, type = "prob")
}
col.order <- c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA")
toc()
head(predictedMatRF[[1]][,col.order])
```



```{r Barierjev test Naključnega gozda na izbranih atributih}
print("Barier's test", quote = F)
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  bar <- sum((observedMat[[i]] - predictedMatRF[[i]]) ^ 2) / nrow(predictedMatRF[[i]])
  cat(bar, "\n")
}
```



```{r Izračun informacijske vsebine Naključnega gozda na izbranih atributih}
cat("Informacijska vsebina odgovora\n")
for (i in 1:11) {
  cat("Mesec =", i+1, " ->  ")
  cat(inf.score(filter(sortedDF_reduced, mesec <= i)$norm_poraba, filter(sortedDF_reduced, mesec == i+1)$norm_poraba, predictedMatRF[[i]]), "\n")
}
```


## Normaliziranje podatkovnega okvirja
```{r Normalizacija zveznih podatkov}
for (i in 1:12) {
  
}
summary(sortedDF_reduced)

names(sortedDF_reduced)
```


## Umetne nevronske mreže

```{r Izračun Nevronske mreže}
library(nnet)
tic("Total")
set.seed(0)
nn_list <- list()

nn_list <- foreach (m=1:11) %do% {
  tempDF <- filter(sortedDF_reduced, mesec <= m)
  nn_list[[m]] <- nnet(norm_poraba ~ ., data = tempDF, size = 5, decay = 0.0001, maxit = 10000)
}
toc()
cat("\014")
```


```{r Napoved po Umetni nevronski mreži}
tic("Total")
predictedNN <- list()
predictedNN <- foreach (i=1:11) %dopar% {
  tempDF <- filter(sortedDF_reduced, mesec == i+1)
  predictedNN[[i]] <- predict(nn_list[[i]], tempDF, type = "class")
}
toc()
```

### Analiza umetne nevronske mreže

```{r Pravilnost rezultatov umetne nevronske mreže}
cat("Pravilnost rezultatov \n")
for(i in 1:11){
  cat("Mesec =", i+1, " ->  ")
  q <- filter(sortedDF_reduced, mesec == i+1)$norm_poraba == predictedNN[[i]]
  cat(mean(q))
  cat(" +/-", sd(q)/sqrt(length(q)), "\n")
}
```













# REGRESIJA                                     



## DEKLARACIJA FUNKCIJ ZA OCENJEVANJE 

```{r Funkcije}
mae <- function(obs, pred)
{
	mean(abs(obs - pred))
}


mse <- function(obs, pred)
{
	mean((obs - pred)^2)
}

rmae <- function(obs, pred, mean.val) 
{  
	sum(abs(obs - pred)) / sum(abs(obs - mean.val))
}

rmse <- function(obs, pred, mean.val) 
{  
	sum((obs - pred)^2)/sum((obs - mean.val)^2)
}
```

Najprej se deklarira funkcije, ki se bojo uporabljale za ocenjevanje modelov.

MAE -> srednja absolutna napaka

MSE -> srednja kvadratna napaka

RMAE -> relativna srednja absolutna napak

RMSE -> relativna srednja kvadratna napaka




## IZBIRANJE ATRIBUTOV Z NAJVEČJIM VPLIVOM NA CILJNO/ODVISNO SPREMENLJIVKO 

```{r}
dataForRegression = subset(sortedDF, select = -c(norm_poraba, teden, UNIX, prev_temp, temp_teden))

dataForRegressionJan <- filter(dataForRegression, mesec == 1)
for (i in 1:ncol(dataForRegressionJan))
  dataForRegressionJan[,i] <- as.factor(dataForRegressionJan[,i])
```

Podatke za regresijo se vzame iz že urejenih podatkov "sortedDF" brez "norm_poraba" in se jih faktorizira. 

```{r}
library(CORElearn)

dataForRegressionJan = subset(dataForRegressionJan, select = -c(mesec))
sort(attrEval(poraba ~ ., dataForRegressionJan, "InfGain"),  decreasing = TRUE)
```
Preveri se kateri atributi največ pripomorejo pri napovedovanju ciljne spremenljivke. Izbere se najboljše, torej
tiste, ki imajo najvišjo oceno. Zaradi prevelike količine podatkov se preveri za vsak mesec posebej(npr. zgoraj za januar).

```{r}
dataForRegression = subset(dataForRegression, select = -c(vikend, padavine, ura, namembnost, oblacnost))
dataForRegression = filter(dataForRegression, regija == "zahodna")
dataForRegression = subset(dataForRegression, select = -c(regija))
summary(dataForRegression)
```

Množica podatkov se zmanjša na 10 atributov (poleg atributa "poraba"), ki najbolj pripomorejo k napovedovanju atributa "poraba".

```{r}
dataForRegressionAll <- sortedDF
dataForRegressionAll = filter(dataForRegressionAll, regija == "zahodna")
dataForRegressionAll = subset(dataForRegressionAll, select = -c(regija))
summary(dataForRegressionAll)
```

Nastavi se še spremenljivka za vse podatke, ki bodo uporabljeni v regresiji.




## EVALVACIJA MODELOV PO MESECIH (REGRESIJA) 

```{r}
podatki <- list()
```

List "podatki" bo držal vse podatke za kasnejšo primerjavo.

## FEBRUAR 

```{r}
dataForRegressionJanAll = filter(dataForRegressionAll, mesec == 1)
dataForRegressionFebAll = filter(dataForRegressionAll, mesec == 2)

dataForTrainAll <- dataForRegressionJanAll
dataForTestAll <- dataForRegressionFebAll

trainAll <- dataForTrainAll
testAll <- dataForTestAll
```

```{r}
dataForRegressionJan = subset(filter(dataForRegression, mesec == 1), select = -c(mesec))
dataForRegressionFeb = subset(filter(dataForRegression, mesec == 2), select = -c(mesec))

dataForTrain <- dataForRegressionJan
dataForTest <- dataForRegressionFeb

train <- dataForTrain
test <- dataForTest
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz januarskih podatkov na februarskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[1]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[2]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO 

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[3]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[4]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[5]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[6]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## MAREC 

```{r}
dataForRegressionFebAll = filter(dataForRegressionAll, mesec == 2)
dataForRegressionMarAll = filter(dataForRegressionAll, mesec == 3)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionFebAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionMarAll
```

```{r}
dataForRegressionFeb = subset(filter(dataForRegression, mesec == 2), select = -c(mesec))
dataForRegressionMar = subset(filter(dataForRegression, mesec == 3), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionFeb)

train <- dataForTrain
test <- dataForRegressionMar
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + februarskih testirali na marčevskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[7]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[8]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[9]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[10]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[11]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[12]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## APRIL 

```{r}
dataForRegressionMarAll = filter(dataForRegressionAll, mesec == 3)
dataForRegressionAprAll = filter(dataForRegressionAll, mesec == 4)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionMarAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionAprAll
```

```{r}
dataForRegressionMar = subset(filter(dataForRegression, mesec == 3), select = -c(mesec))
dataForRegressionApr = subset(filter(dataForRegression, mesec == 4), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionMar)

train <- dataForTrain
test <- dataForRegressionApr
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + marčevskih testirali na aprilskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[13]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[14]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[15]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[16]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[17]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[18]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## MAJ 


```{r}
dataForRegressionAprAll = filter(dataForRegressionAll, mesec == 4)
dataForRegressionMayAll = filter(dataForRegressionAll, mesec == 5)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionAprAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionMayAll
```

```{r}
dataForRegressionApr = subset(filter(dataForRegression, mesec == 4), select = -c(mesec))
dataForRegressionMay = subset(filter(dataForRegression, mesec == 5), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionApr)

train <- dataForTrain
test <- dataForRegressionMay
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + aprilskih testirali na majevih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[19]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[20]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[21]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[22]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[23]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[24]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## JUNIJ 

```{r}
dataForRegressionMayAll = filter(dataForRegressionAll, mesec == 5)
dataForRegressionJunAll = filter(dataForRegressionAll, mesec == 6)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionMayAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionJunAll
```

```{r}
dataForRegressionMay = subset(filter(dataForRegression, mesec == 5), select = -c(mesec))
dataForRegressionJun = subset(filter(dataForRegression, mesec == 6), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionMay)

train <- dataForTrain
test <- dataForRegressionJun
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + majevih testirali na junijskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[25]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[26]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[27]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[28]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[29]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[30]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## JULIJ 


```{r}
dataForRegressionJunAll = filter(dataForRegressionAll, mesec == 6)
dataForRegressionJulAll = filter(dataForRegressionAll, mesec == 7)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionJunAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionJulAll
```

```{r}
dataForRegressionJun = subset(filter(dataForRegression, mesec == 6), select = -c(mesec))
dataForRegressionJul = subset(filter(dataForRegression, mesec == 7), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionJun)

train <- dataForTrain
test <- dataForRegressionJul
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + junijskih testirali na julijskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[31]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[32]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[33]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[34]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[35]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[36]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## AUGUST 

```{r}
dataForRegressionJulAll = filter(dataForRegressionAll, mesec == 7)
dataForRegressionAugAll = filter(dataForRegressionAll, mesec == 8)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionJulAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionAugAll
```

```{r}
dataForRegressionJul = subset(filter(dataForRegression, mesec == 7), select = -c(mesec))
dataForRegressionAug = subset(filter(dataForRegression, mesec == 8), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionJul)

train <- dataForTrain
test <- dataForRegressionAug
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + julijskih testirali na avgustovih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[37]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[38]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[39]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[40]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[41]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[42]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## SEPTEMBER 

```{r}
dataForRegressionAugAll = filter(dataForRegressionAll, mesec == 8)
dataForRegressionSepAll = filter(dataForRegressionAll, mesec == 9)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionAugAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionSepAll
```

```{r}
dataForRegressionAug = subset(filter(dataForRegression, mesec == 8), select = -c(mesec))
dataForRegressionSep = subset(filter(dataForRegression, mesec == 9), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionAug)

train <- dataForTrain
test <- dataForRegressionSep
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + avgustovih testirali na septemrskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[43]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[44]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[45]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[46]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[47]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[48]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## OKTOBER 

```{r}
dataForRegressionSepAll = filter(dataForRegressionAll, mesec == 9)
dataForRegressionOctAll = filter(dataForRegressionAll, mesec == 10)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionSepAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionOctAll
```

```{r}
dataForRegressionSep = subset(filter(dataForRegression, mesec == 9), select = -c(mesec))
dataForRegressionOct = subset(filter(dataForRegression, mesec == 10), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionSep)

train <- dataForTrain
test <- dataForRegressionOct
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + septembrskih testirali na oktobrskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[49]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[50]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[51]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[52]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[53]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[54]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## NOVEMBER 

```{r}
dataForRegressionOctAll = filter(dataForRegressionAll, mesec == 10)
dataForRegressionNovAll = filter(dataForRegressionAll, mesec == 11)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionOctAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionNovAll
```

```{r}
dataForRegressionOct = subset(filter(dataForRegression, mesec == 10), select = -c(mesec))
dataForRegressionNov = subset(filter(dataForRegression, mesec == 11), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionOct)

train <- dataForTrain
test <- dataForRegressionNov
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + oktobrskih testirali na novembrskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[55]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[56]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[57]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[58]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[59]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[60]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




## DECEMBER 

```{r}
dataForRegressionNovAll = filter(dataForRegressionAll, mesec == 11)
dataForRegressionDecAll = filter(dataForRegressionAll, mesec == 12)

dataForTrainAll <- rbind(dataForTrainAll, dataForRegressionNovAll)

trainAll <- dataForTrainAll
testAll <- dataForRegressionDecAll
```

```{r}
dataForRegressionNov = subset(filter(dataForRegression, mesec == 11), select = -c(mesec))
dataForRegressionDec = subset(filter(dataForRegression, mesec == 12), select = -c(mesec))

dataForTrain <- rbind(dataForTrain, dataForRegressionNov)

train <- dataForTrain
test <- dataForRegressionDec
```

Nastavi se učne in testne podatke. V tem primeru bomo testirali modele narejene iz vseh dosedanjih + novembrskih testirali na decembrskih podatkih. Zgornji odlomek kode predstavlja vse podatke, spodnji pa le izbrane atribute.

### LINEARNA REGRESIJA 

#### Vsi podatki

```{r}
model <- lm(poraba ~ ., trainAll)
predicted <- predict(model, testAll)
observed <- testAll$poraba

podatki[[61]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(trainAll$poraba)), rmse(observed, predicted, mean(trainAll$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

#### Izbrani podatki

```{r}
model <- lm(poraba ~ ., train)
predicted <- predict(model, test)
observed <- test$poraba

podatki[[62]] <- c(mae(observed, predicted), sqrt(mse(observed, predicted)), rmae(observed, predicted, mean(train$poraba)), rmse(observed, predicted, mean(train$poraba)))
cat("\014")

plot(observed, xlab="", ylab="", main="GRAFIČNI PRIKAZ OPAZOVANIH IN PREDVIDENIH PODATKOV", sub="Črne točke so opazovane, rdeče pa predvidene.")
points(predicted, col="red")
```

### REGRESIJSKO DREVO

#### Vsi podatki

```{r}
rt.model <- rpart(poraba ~ ., data=trainAll)
rpart.plot(rt.model)
predicted <- predict(rt.model, testAll)

podatki[[63]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rt.model <- rpart(poraba ~ ., data=train)
rpart.plot(rt.model)
predicted <- predict(rt.model, test)

podatki[[64]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```

### NAKLJUČNI GOZD

#### Vsi podatki

```{r}
rf.model <- randomForest(poraba ~ ., trainAll, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, testAll)

podatki[[65]] <- c(mae(testAll$poraba, predicted), rmae(testAll$poraba, predicted, mean(trainAll$poraba)))
cat("\014")
```

#### Izbrani podatki

```{r}
rf.model <- randomForest(poraba ~ ., train, ntree=10, norm.votes=FALSE)
predicted <- predict(rf.model, test)

podatki[[66]] <- c(mae(test$poraba, predicted), rmae(test$poraba, predicted, mean(train$poraba)))
cat("\014")
```




# PRIKAZ PODATKOV REGRESIJE (PRIMERJAVA VSEH PODATKOV Z IZBRANIMI)

```{r}
podatkiRegresija <- read.csv("../../AI-naloga/podatkiRegresija.txt", stringsAsFactors=TRUE)
podatkiRegresija
```

Zgoraj so prikazani vsi zbrani podatki za vse mesece, napake mae,mse,rmae in rmse in vse uporabljene modele.

## LINEARNA REGRESIJA

```{r}
podatkiRegresijaLinearna = filter(podatkiRegresija, model == "linearna_regresija")
podatkiRegresijaLinearnaMae = filter(podatkiRegresijaLinearna, vrsta_napake == "mae")
podatkiRegresijaLinearnaMaeVsi = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "vsi")
podatkiRegresijaLinearnaMaeIzbrani = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeVsi$napaka,main="VSI PODATKI - LINEARNA REGRESIJA", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeIzbrani$napaka,main="IZBRANI PODATKI - LINEARNA REGRESIJA", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
```

Številke na X osi prikazujejo mesece za katere smo napovedovali in sicer od februarja do decembra glede na mesec, ki smo ga napovedovali. Opazimo, da so napake pri izbranih podatkih večje, kar pomeni, da je model zgrajen iz vseh danih podatkov boljši od tega iz podatkov, ki največ pripomorejo k oceni atributa "poraba". Napake pa seveda iz meseca v mesec variirajo.


## REGRESIJSKO DREVO

```{r}
podatkiRegresijaDrevo = filter(podatkiRegresija, model == "regresijsko_drevo")
podatkiRegresijaDrevoMae = filter(podatkiRegresijaDrevo, vrsta_napake == "mae")
podatkiRegresijaDrevoMaeVsi = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "vsi")
podatkiRegresijaDrevoMaeIzbrani = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeVsi$napaka,main="VSI PODATKI - REGRESIJSKO DREVO", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeIzbrani$napaka,main="IZBRANI PODATKI - REGRESIJSKO DREVO", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
```

Tako kot pri linearnem modelu tudi tukaj opazimo, da nam model grajen na vseh podatkih vrne boljše rezultate (nižje napake).


## NAKLJUČNI GOZD

```{r}
podatkiRegresijaGozd = filter(podatkiRegresija, model == "nakljucni_gozd")
podatkiRegresijaGozdMae = filter(podatkiRegresijaGozd, vrsta_napake == "mae")
podatkiRegresijaGozdMaeVsi = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "vsi")
podatkiRegresijaGozdMaeIzbrani = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeVsi$napaka,main="VSI PODATKI - NAKLJUČNI GOZD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeIzbrani$napaka,main="IZBRANI PODATKI - NAKLJUČNI GOZD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
```

Enako kot pri obeh predhodnih modelih tudi naključni gozd za vse podatke vrne boljše rezultate kot za izbrane. Glede na ostala dva modela pa se izkaže za najboljšega izmed uporabljenih treh, saj ima najmanjše absolutne napake.




# PRIKAZ PODATKOV REGRESIJE (PRIMERJAVA VZHODA, ZAHODA IN OBEH HKRATI)


```{r}
podatkiRegresijaVzhod <- read.csv("../../AI-naloga/podatkiRegresijaVzhod.txt", stringsAsFactors=TRUE)
podatkiRegresijaVzhod
```

Zgoraj so prikazani podatki za vzhodne stavbe.

```{r}
podatkiRegresijaZahod <- read.csv("../../AI-naloga/podatkiRegresijaZahod.txt", stringsAsFactors=TRUE)
podatkiRegresijaZahod
```

Zgoraj so prikazani podatki za zahodne stavbe.


## LINEARNA REGRESIJA

```{r}
podatkiRegresijaLinearna = filter(podatkiRegresijaVzhod, model == "linearna_regresija")
podatkiRegresijaLinearnaMae = filter(podatkiRegresijaLinearna, vrsta_napake == "mae")
podatkiRegresijaLinearnaMaeVsi = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "vsi")
podatkiRegresijaLinearnaMaeIzbrani = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeVsi$napaka,main="VSI PODATKI - LINEARNA REGRESIJA - VZHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeIzbrani$napaka,main="IZBRANI PODATKI - LINEARNA REGRESIJA - VZHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")


podatkiRegresijaLinearna = filter(podatkiRegresijaZahod, model == "linearna_regresija")
podatkiRegresijaLinearnaMae = filter(podatkiRegresijaLinearna, vrsta_napake == "mae")
podatkiRegresijaLinearnaMaeVsi = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "vsi")
podatkiRegresijaLinearnaMaeIzbrani = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeVsi$napaka,main="VSI PODATKI - LINEARNA REGRESIJA - ZAHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeIzbrani$napaka,main="IZBRANI PODATKI - LINEARNA REGRESIJA - ZAHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")


podatkiRegresijaLinearna = filter(podatkiRegresija, model == "linearna_regresija")
podatkiRegresijaLinearnaMae = filter(podatkiRegresijaLinearna, vrsta_napake == "mae")
podatkiRegresijaLinearnaMaeVsi = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "vsi")
podatkiRegresijaLinearnaMaeIzbrani = filter(podatkiRegresijaLinearnaMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeVsi$napaka,main="VSI PODATKI - LINEARNA REGRESIJA - OBOJE", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaLinearnaMaeIzbrani$napaka,main="IZBRANI PODATKI - LINEARNA REGRESIJA - OBOJE", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
```

## REGRESIJSKO DREVO

```{r}
podatkiRegresijaDrevo = filter(podatkiRegresijaVzhod, model == "regresijsko_drevo")
podatkiRegresijaDrevoMae = filter(podatkiRegresijaDrevo, vrsta_napake == "mae")
podatkiRegresijaDrevoMaeVsi = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "vsi")
podatkiRegresijaDrevoMaeIzbrani = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeVsi$napaka,main="VSI PODATKI - REGRESIJSKO DREVO - VZHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeIzbrani$napaka,main="IZBRANI PODATKI - REGRESIJSKO DREVO - VZHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")


podatkiRegresijaDrevo = filter(podatkiRegresijaZahod, model == "regresijsko_drevo")
podatkiRegresijaDrevoMae = filter(podatkiRegresijaDrevo, vrsta_napake == "mae")
podatkiRegresijaDrevoMaeVsi = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "vsi")
podatkiRegresijaDrevoMaeIzbrani = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeVsi$napaka,main="VSI PODATKI - REGRESIJSKO DREVO - ZAHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeIzbrani$napaka,main="IZBRANI PODATKI - REGRESIJSKO DREVO - ZAHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")


podatkiRegresijaDrevo = filter(podatkiRegresija, model == "regresijsko_drevo")
podatkiRegresijaDrevoMae = filter(podatkiRegresijaDrevo, vrsta_napake == "mae")
podatkiRegresijaDrevoMaeVsi = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "vsi")
podatkiRegresijaDrevoMaeIzbrani = filter(podatkiRegresijaDrevoMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeVsi$napaka,main="VSI PODATKI - REGRESIJSKO DREVO - OBOJE", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaDrevoMaeIzbrani$napaka,main="IZBRANI PODATKI - REGRESIJSKO DREVO - OBOJE", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
```

## NAKLJUČNI GOZD

```{r}
podatkiRegresijaGozd = filter(podatkiRegresijaVzhod, model == "nakljucni_gozd")
podatkiRegresijaGozdMae = filter(podatkiRegresijaGozd, vrsta_napake == "mae")
podatkiRegresijaGozdMaeVsi = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "vsi")
podatkiRegresijaGozdMaeIzbrani = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeVsi$napaka,main="VSI PODATKI - NAKLJUČNI GOZD - VZHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeIzbrani$napaka,main="IZBRANI PODATKI - NAKLJUČNI GOZD - VZHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")


podatkiRegresijaGozd = filter(podatkiRegresijaZahod, model == "nakljucni_gozd")
podatkiRegresijaGozdMae = filter(podatkiRegresijaGozd, vrsta_napake == "mae")
podatkiRegresijaGozdMaeVsi = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "vsi")
podatkiRegresijaGozdMaeIzbrani = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeVsi$napaka,main="VSI PODATKI - NAKLJUČNI GOZD - ZAHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeIzbrani$napaka,main="IZBRANI PODATKI - NAKLJUČNI GOZD - ZAHOD", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")


podatkiRegresijaGozd = filter(podatkiRegresija, model == "nakljucni_gozd")
podatkiRegresijaGozdMae = filter(podatkiRegresijaGozd, vrsta_napake == "mae")
podatkiRegresijaGozdMaeVsi = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "vsi")
podatkiRegresijaGozdMaeIzbrani = filter(podatkiRegresijaGozdMae, kolicina_podatkov == "izbrani")

plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeVsi$napaka,main="VSI PODATKI - NAKLJUČNI GOZD - OBOJE", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
plot(factor(podatkiRegresijaLinearnaMaeVsi$mesec, levels=c("februar", "marec", "april", "maj", "junij", "julij", "avgust", "september", "oktober", "november", "december")), podatkiRegresijaGozdMaeIzbrani$napaka,main="IZBRANI PODATKI - NAKLJUČNI GOZD - OBOJE", xlab="MESECI", ylab="SREDNJA ABSOLUTNA NAPAKA")
```

























