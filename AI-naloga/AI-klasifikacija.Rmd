---
title: "AI-naloga-unfinished"
output: html_notebook
---

## Obdelava podatkov in dodajanje atributov

Na začetku uvozimo podatke z gumbom v RStudio imenovanem "Import Dataset" in sicer izberemo opcijo "From Text(base)". Nato ustvarimo novo delovno spremenljivko "data", da ostane prvotna spremenljivka nespremenjena. 


```{r}
data <- dataSem1
data$regija <- as.factor(data$regija)
data$namembnost <- as.factor(data$namembnost)
data$norm_poraba <- as.factor(data$norm_poraba)

head(data)
```
Atribute "regija", "namembnost" in "norm_poraba" faktoriziramo, da programski jezik razbere zalogo vrednosti. V tabeli zgoraj je prikazanih prvih nekaj vrstic. 

```{r}
data$datum <- as.Date(data$datum)
head(data)

```
Lastnost atributa "datum" nastavimo na <date>.

```{r}
newData <- week(data$datum)

data$teden <- newData

newNewData <- month(data$datum)
data$mesec <- newNewData

head(data)
```
V tem delu dodamo nova atributa "teden" in "mesec" za lažje nadaljno delo. Za pomoč uporabimo knjižnico "lubridate".

```{r}
x <- is.weekend(data$datum)
data$vikend <- x

#summary(data)
```
Zgornja koda prikazuje kako dodamo atribut "vikend", ki ima vrednost TRUE, če je dan sobota ali nedelja, oziroma FALSE, če je delovni dan. Pomagamo si s knjižnico "chron".


```{r}
data$UNIX <- as.numeric(as.POSIXct(paste(data$datum, data$ura, sep=" ")))
#data
```
Ustvarimo splošen atribut za čas, ki nam omogoča lažje sortiranje.




```{r}
#rm(a)
a <- order(data$stavba, data$ura, data$UNIX)
sortedDF <- data[a,]
#data
sortedDF
```
Dataframe sortiramo po številki stavbe, uri meritve in UNIX času.


```{r}
vect = vector()
starTemp = 0
uraMeritve = 0
for (row in 1:nrow(sortedDF))
{
  if(uraMeritve == sortedDF[row, "ura"]) {
    vect <- c(vect, starTemp)
  }
  else {
    uraMeritve = sortedDF[row, "ura"]
    vect <- c(vect, sortedDF[row, "temp_zraka"])
  }
  starTemp = sortedDF[row, "temp_zraka"]
}

```


```{r}
sortedDF$prev_temp <- vect
head(sortedDF)
```
S kodo zgornjih dveh odlomkov vsaki meritvi v sortirani matriki poiščemo meritev temperature prejšnjega dne in ji le to dopišemo v poseben stolpec z atributi.



```{r}
vect = vector()
starTemp = 0
uraMeritve = 0
substract = 0
beginning = 0
stevec = 0
for (row in 1:nrow(sortedDF))
{
  if(beginning < row-7)
    stevec = row-7
  else
    stevec = beginning
  if(uraMeritve == sortedDF[row, "ura"]) {
    starTemp = 0
    #r <- which(sortedDF[, "stavba"] == sortedDF[row, "stavba"] & sortedDF[, "ura"] == sortedDF[row, "ura"] & sortedDF[, "datum"] == sortedDF[row, "datum"] - substract)
    for (i in stevec:(row-1))
      starTemp = starTemp + sortedDF[i, "temp_zraka"]
    avgTemp = starTemp / (row - stevec)
    vect <- c(vect, avgTemp)
  }
  else {
    beginning = row
    uraMeritve = sortedDF[row, "ura"]
    vect <- c(vect, sortedDF[row, "temp_zraka"])
  }
  starTemp = sortedDF[row, "temp_zraka"]
}

vect
```

```{r}
sortedDF$temp_teden <- vect
```
Z zanko se sprehodimo po vsaki meritvi v matriki in izračunamo povprečje največ zadnjih 7 meritev za isto stavbo ob isti uri. Povprečno temperaturo zapišemo v stolpec z imenom "temp_teden".



## Večinski razred

```{r}
X = factor(sortedDF$norm_poraba, levels=c("ZELONIZKA", "NIZKA", "SREDNJA", "VISOKA", "ZELOVISOKA"))
plot(X, main = "Porazdelitev primerov glede na normirano stopnjo porabe")
```
```{r}
summary(X)
```
Večinski parameter je vrednost "SREDNJA", ki predstavlja 76.435 vrednosti od 206.785, kar je 0,3696 od celotne zaloge elementov.


## Odločitveno drevo

```{r}
tempDF <- sortedDF
drops <- c("poraba")
tempDF <- tempDF[ , !(names(tempDF) %in% drops)]
dt <- rpart(norm_poraba ~ ., data = tempDF)
```

```{r}
rpart.plot(dt)
```
```{r}
tempDFJan <- filter(sortedDF, mesec == 1)

drops <- c("poraba")
tempDFJan <- tempDFJan[ , !(names(tempDFJan) %in% drops)]
dt1 <- rpart(norm_poraba ~ ., data = tempDFJan)

rpart.plot(dt1)
```

Za izluščenje le posameznega meseca se uporabi knjižnica "dplyr", kjer s pomočjo fukcije "filter" izluščimo le podatke določenega meseca. Zgornji primer je za Januar.


```{r}
tempDFFeb <- filter(sortedDF, mesec == 2)

drops <- c("poraba")
tempDFFeb <- tempDFFeb[ , !(names(tempDFFeb) %in% drops)]
dt2 <- rpart(norm_poraba ~ ., data = tempDFFeb)

rpart.plot(dt2)
```

```{r}
tempDFMar <- filter(sortedDF, mesec == 3)

drops <- c("poraba")
tempDFMar <- tempDFMar[ , !(names(tempDFMar) %in% drops)]
dt3 <- rpart(norm_poraba ~ ., data = tempDFMar)

rpart.plot(dt3)
```

```{r}
tempDFApr <- filter(sortedDF, mesec == 4)

drops <- c("poraba")
tempDFApr <- tempDFApr[ , !(names(tempDFApr) %in% drops)]
dt4 <- rpart(norm_poraba ~ ., data = tempDFApr)

rpart.plot(dt4)
```

```{r}
tempDFMay <- filter(sortedDF, mesec == 5)

drops <- c("poraba")
tempDFMay <- tempDFMay[ , !(names(tempDFMay) %in% drops)]
dt5 <- rpart(norm_poraba ~ ., data = tempDFMay)

rpart.plot(dt5)
```

```{r}
tempDFJun <- filter(sortedDF, mesec == 6)

drops <- c("poraba")
tempDFJun <- tempDFJun[ , !(names(tempDFJun) %in% drops)]
dt6 <- rpart(norm_poraba ~ ., data = tempDFJun)

rpart.plot(dt6)
```

```{r}
tempDFJul <- filter(sortedDF, mesec == 7)

drops <- c("poraba")
tempDFJul <- tempDFJul[ , !(names(tempDFJul) %in% drops)]
dt7 <- rpart(norm_poraba ~ ., data = tempDFJul)

rpart.plot(dt7)
```

```{r}
tempDFAug <- filter(sortedDF, mesec == 8)

drops <- c("poraba")
tempDFAug <- tempDFAug[ , !(names(tempDFAug) %in% drops)]
dt8 <- rpart(norm_poraba ~ ., data = tempDFAug)

rpart.plot(dt8)
```

```{r}
tempDFSep <- filter(sortedDF, mesec == 9)

drops <- c("poraba")
tempDFSep <- tempDFSep[ , !(names(tempDFSep) %in% drops)]
dt9 <- rpart(norm_poraba ~ ., data = tempDFSep)

rpart.plot(dt9)
```

```{r}
tempDFOct <- filter(sortedDF, mesec == 10)

drops <- c("poraba")
tempDFOct <- tempDFOct[ , !(names(tempDFOct) %in% drops)]
dt10 <- rpart(norm_poraba ~ ., data = tempDFOct)

rpart.plot(dt10)
```

```{r}
tempDFNov <- filter(sortedDF, mesec == 11)

drops <- c("poraba")
tempDFNov <- tempDFNov[ , !(names(tempDFNov) %in% drops)]
dt11 <- rpart(norm_poraba ~ ., data = tempDFNov)

rpart.plot(dt11)
```

```{r}
tempDFDec <- filter(sortedDF, mesec == 12)

drops <- c("poraba")
tempDFDec <- tempDFDec[ , !(names(tempDFDec) %in% drops)]
dt12 <- rpart(norm_poraba ~ ., data = tempDFDec)

rpart.plot(dt12)
```

Zgoraj so narejena drevesa za vseh 12 mesecev razen Januarja, ki je že narejen.







This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
